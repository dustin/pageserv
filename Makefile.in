# Copyright (c) 1997   Dustin Sallings
# $Id: Makefile.in,v 1.10 1997/03/26 00:24:40 dustin Exp $

MAJOR=2
MINOR=0
PATCH=1
VERSION=$(MAJOR).$(MINOR).$(PATCH)

SHELL=/bin/sh
CC=@CC@
YACC=@YACC@
CFLAGS=-g -DVERSION=\"$(VERSION)\"

LIBS=@LIBS@

LDFLAGS=-g $(LIBS)

SERV_OBJS=sockets.o main.o utility.o kids.o queue.o protocol.o userdb.o \
	readconfig.o
PQ_OBJS=pqueue.o utility.o queue.o userdb.o readconfig.o
PU_OBJS=parseusers.o userdb.o utility.o readconfig.o
LU_OBJS=listusers.o userdb.o utility.o readconfig.o
SOURCES=sockets.c main.c utility.c kids.c queue.c protocol.c pqueue.c \
	parseusers.c userdb.c listusers.c readconfig.c
EXES=pageserv pqueue parseusers listusers
DIRS=clients
NAME=pageserv
ARCHIVE=$(NAME)-$(VERSION)
STUFF=$(SOURCES) pageserv.h configure configure.in Makefile.in clients \
	README config.h.in sample.config
JUNK=$(EXES) *.o *.core core
AUTOJUNK=config.status config.cache config.log Makefile clients/Makefile \
	config.h

all: $(EXES)

pageserv: $(SERV_OBJS)
	$(CC) -o $@ $(SERV_OBJS) $(LDFLAGS)

pqueue: $(PQ_OBJS)
	$(CC) -o $@ $(PQ_OBJS) $(LDFLAGS)

parseusers: $(PU_OBJS)
	$(CC) -o $@ $(PU_OBJS) $(LDFLAGS)

listusers: $(LU_OBJS)
	$(CC) -o $@ $(LU_OBJS) $(LDFLAGS)

depend:
	echo "" >> Makefile
	echo "# Automatically generated dependencies:" >> Makefile
	$(CC) $(CFLAGS) -M $(SOURCES) >> Makefile

tgz: $(ARCHIVE).tar.gz

$(ARCHIVE).tar.gz: $(STUFF)
	rm -f $(ARCHIVE).tar.gz
	mkdir $(ARCHIVE)
	cp -r $(STUFF) $(ARCHIVE)
	tar -cvf $(ARCHIVE).tar $(ARCHIVE)
	rm -rf $(ARCHIVE)
	gzip -9v $(ARCHIVE).tar

# irix globbing shit.
irixhack.o:
	@touch irixhack.o

clean:  irixhack.o
	for i in $(DIRS) ; do cd $$i && $(MAKE) clean ; done
	rm -f $(JUNK)

ultrabrite: irixhack.o
	for i in $(DIRS) ; do cd $$i && $(MAKE) clean ; done
	rm -f $(JUNK) $(AUTOJUNK)
